<!DOCTYPE html>
<html>
  <head>
    <title>JavaScript D3 Plot</title>
    <style> /* set the CSS */
    body {
        margin: 0px;
        overflow: hidden;
    } 

    text {
        font-family: sans-serif;
    }

    .tick text {
        font-size: 2em;
        fill: #635F5D;
    }

    .tick line {
        stroke: #C0C0BB;
    }

    .axis-label {
        font-size: 3em;
        fill: 'black'
    }

    .tooltip {
        position: absolute;
        font-size: 12px;
        width:  auto;
        height: auto;
        pointer-events: none;
        background-color: white;
    }

    </style>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  </head>
  <body>
    
    <svg width="1400" height="650"></svg>
    
    <div id="vis-container"></div>

    <script>
        const svg = d3.select('svg');

        const width = +svg.attr('width');
        const height = +svg.attr('height');

        var clust = 1;

        const margin = { top: 20, right: 40, bottom: 88, left: 150 };
        const innerWidth = width/2 - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;

        const h = svg.append('g')
            .attr('transform', `translate(${margin.left + width/2},${margin.top})`);

        // CHANGE BASED ON DROPDOWN VALUE
        var region = "FrontalCortex"

        var gene = "SATB2"

        d3.csv('https://nshedd.github.io/final/data/combined.csv')
        .then(data => {
            data = data.filter((d) => {
                return d.brain_region == region;
            });
            data.forEach(d => {
                d.UMAP_1 = +d.UMAP_1;
                d.UMAP_2 = +d.UMAP_2;
                d.celltype = +d.celltype;
            });
            const xValue = d => d.UMAP_1;
            const xAxisLabel = 'UMAP 1';
            
            const yValue = d => d.UMAP_2;
            const yAxisLabel = 'UMAP 2';        

            const featValue = d => d[gene];    

            const xScale = d3.scaleLinear()
                .domain(d3.extent(data, xValue))
                .range([0, innerWidth])
                .nice();
            
            const yScale = d3.scaleLinear()
                .domain(d3.extent(data, yValue))
                .range([innerHeight, 0])
                .nice();
            
            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            const xAxis = d3.axisBottom(xScale);
            
            const yAxis = d3.axisLeft(yScale);

            var clust_color = d3.scaleOrdinal(["rgb(6,150,104)", "rgb(196,74,137)", "rgb(179,230,28)", "rgb(181,3,209)", "rgb(39,213,61)", "rgb(255,0,135)", "rgb(150,231,154)", "rgb(241,67,48)", "rgb(121,227,249)", "rgb(143,15,18)", "rgb(135,169,253)", "rgb(37,80,38)", "rgb(253,146,250)", "rgb(101,161,14)", "rgb(112,83,217)", "rgb(252,206,106)", "rgb(71,69,86)", "rgb(247,144,100)", "rgb(5,157,197)", "rgb(104,61,13)", "rgb(226,209,203)", "rgb(45,104,199)"]);
            
            var gene_color = d3.scaleLinear()
                .domain(d3.extent(data, featValue))
                .range(['lightgray','blue']);

            const yAxisG = g.append('g').call(yAxis);
            yAxisG.selectAll('.domain').remove();
            
            yAxisG.append('text')
                .attr('class', 'axis-label')
                .attr('y', -93)
                .attr('x', -innerHeight / 2)
                .attr('fill', 'black')
                .attr('transform', `rotate(-90)`)
                .attr('text-anchor', 'middle')
                .text(yAxisLabel);
            
            const xAxisG = g.append('g').call(xAxis)
                .attr('transform', `translate(5,${innerHeight})`)
            
            xAxisG.select('.domain').remove();
            
            xAxisG.append('text')
                .attr('class', 'axis-label')
                .attr('y', 75)
                .attr('x', innerWidth / 2)
                .attr('fill', 'black')
                .text(xAxisLabel);

            g.selectAll('circle').data(data)
                .enter().append('circle')
                .attr('cy', d => yScale(yValue(d)))
                .attr('cx', d => xScale(xValue(d)))
                .attr('r', 2)
                .attr("fill", function(d) { return clust_color(d.celltype); })



            const yAxisH = h.append('g').call(yAxis);

            yAxisH.selectAll('.domain').remove();
            
            yAxisH.append('text')
                .attr('class', 'axis-label')
                .attr('y', -93)
                .attr('x', -innerHeight / 2)
                .attr('fill', 'black')
                .attr('transform', `rotate(-90)`)
                .attr('text-anchor', 'middle')
                .text(yAxisLabel);
            
            const xAxisH = h.append('g').call(xAxis)
                .attr('transform', `translate(5,${innerHeight})`)
            
            xAxisH.select('.domain').remove();
            
            xAxisH.append('text')
                .attr('class', 'axis-label')
                .attr('y', 75)
                .attr('x', innerWidth / 2)
                .attr('fill', 'black')
                .text(xAxisLabel);

            h.selectAll('circle').data(data)
                .enter().append('circle')
                .attr('cy', d => yScale(yValue(d)))
                .attr('cx', d => xScale(xValue(d)))
                .attr('r', 2)
                .attr("fill", function(d) { return gene_color(d[gene]); })
        });


            
    
    </script>
  </body>
</html>